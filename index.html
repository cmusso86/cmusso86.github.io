<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>‘R de trás pra frente’</title>
    <meta charset="utf-8" />
    <meta name="author" content="Carolina Musso" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="css/xaringan-themerCIEVS.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# ‘R de trás pra frente’
## Aula 15
### Carolina Musso
### 17/03/22

---







class: inverse center middle

# Módulo 4:
## Nada se cria, tudo se transforma......

---

## Aula passada


- **Função mutate() e group_by() e summarise** 
  - criar novas colunas com novas variáveis
  - agrupar os dados
  - reduzir a base de acordo com esses grupos
    - cuidado com as contas a se fazer de acordo com os agrupamentos!

- **Agora mudamos muito os dados!!**

  - Pensar com cuidado!
---

### Hoje:

- Trabalhando com datas.

--

- É muito chato!

--
  
- Incompatibilidade de formatos: d/m/a ; a-m-d
  
--

- É caracter ou numérico?

--

  
####Alguém leu o capítulo?

&lt;center&gt;&lt;img src="img/fry.jpeg" height=180px" /&gt;&lt;/center&gt;


---

### Como o R reconhece a data?


```r
Sys.Date()
```

```
## [1] "2022-03-16"
```


```r
Sys.time()
```

```
## [1] "2022-03-16 20:55:26 -03"
```

**VOCÊ SÓ CONSEGUE FAZER CONTAS NESSE FORMATO**

--

- Ou seja, se não estiver, você tem que **transformar**!

---

### Leituras de aprofundamento

- [EpiHandbook, 9.Working with dates](&lt;https://www.epirhandbook.com/en/working-with-dates.html&gt;)

- [Curso-R, 7.5 O pacote lubridate](&lt;https://livro.curso-r.com/7-5-o-pacote-lubridate.html&gt;)

- [DataCamp, Working with Dates and Times with R](&lt;https://app.datacamp.com/learn/courses/working-with-dates-and-times-in-r&gt;)

- [R4DS, 16. Dates and Times](&lt;https://r4ds.had.co.nz/dates-and-times.html&gt;) 
- [Lubridate CheatSheet](&lt;https://rawgit.com/rstudio/cheatsheets/main/lubridate.pdf&gt;)
---
### Pacote lubridate 

- A intenção é sempre pegar uma data que está no "nosso formato".

- Ver o formato que ela está.

- "Avisar" pro R o formato que ela está.

- Para ele conseguir colocar no formato que ele consiga ler.


```r
library(tidyverse)
hoje&lt;-"17/03/2022"
lubridate::dmy(hoje)
```

```
## [1] "2022-03-17"
```

---
### Ele é muito bom em adivinhar coisas! 

```r
hoje&lt;-"17032022"
lubridate::dmy(hoje)
```

```
## [1] "2022-03-17"
```


```r
hoje&lt;-"17-03-2022"
lubridate::dmy(hoje)
```

```
## [1] "2022-03-17"
```


```r
hoje&lt;-"1703     22"
lubridate::dmy(hoje)
```

```
## [1] "2022-03-17"
```

---
### Com o R base 



```r
hoje&lt;-"17/02/2022"

as.Date(hoje, format="%d/%m/%Y") 
```

```
## [1] "2022-02-17"
```

- Diga o formato em que ele estava! 

%d = dia

%m= mês número ; %B= mês nome ; %b= nome abreviado

%y = ano com 2 dígitod (ex. 89 ; %Y = ano com 4 dígitos (ex. 1989)

%A = Dia da semana (Segunda, Terça, etc.) 

%U = Semana (01-53)
---

### Pronto

--

- Bom, isso é quando está fácil...

- Há vários outros problemas que podem acontecer...

--

- Mas o importante é: tem que ter


```r
hoje&lt;-Sys.Date()
class(hoje)
```

```
## [1] "Date"
```

- Assim contigo fazer contas!

---

### Contas com datas


```r
library(lubridate)
hoje&lt;-Sys.Date()
hoje
```

```
## [1] "2022-03-16"
```


```r
hoje + days(3)
```

```
## [1] "2022-03-19"
```


```r
hoje + 3
```

```
## [1] "2022-03-19"
```
---
### Contas com datas


```r
hoje + months(1)
```

```
## [1] "2022-04-16"
```


```r
hoje - years(20)
```

```
## [1] "2002-03-16"
```

---

### Intervalo de tempo


```r
diferenca&lt;-hoje - ymd("2020-02-20")
diferenca
```

```
## Time difference of 755 days
```


```r
diferenca&lt;-as.numeric(diferenca)
```


```r
passado&lt;-hoje-10
diferenca&lt;-difftime(hoje,passado, units = "weeks")
diferenca
```

```
## Time difference of 1.428571 weeks
```

---
### Mas a data assim fica feio!

- Não estamos costumados a mostrar a data nesse formato de YYY-mm-dd

- **DEPOIS** de fazer as contas, ordenações que eu quiser, eu possi escolher apresentar nas tabelas, gráficos, texto, de outra forma... para isso, existe a funçao `format`. 

- É a idéia do as.Date, ao contrário...


```r
format(Sys.Date(), format = "%d %B %Y")
```

```
## [1] "16 Março 2022"
```
---
### Semanas epidemiológicas

- Tem uma função que calcula as semanas epidemiológicas `epiweek()
  - Desde que a data esteja como? **Naquele formato que o R entende que é uma data!**
  
### ggplot e datas

[Exemploes em: Datanovia](&lt;https://www.datanovia.com/en/blog/ggplot-date-axis-customization/&gt;)


```r
+
scale_x_date(date_labels = "%b/%d")
```

---

### Ao trabalho!

&lt;center&gt;&lt;img src="img/exer.gif" height=400px" /&gt;&lt;/center&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
